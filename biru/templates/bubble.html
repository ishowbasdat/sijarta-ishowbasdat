<div class="top-0 py-4 mt-4 font-medium text-gray-700 shadow-sm">
    Testimoni
</div>
<div id="testimonial-container" class="bg-white rounded-lg shadow-sm h-full sm:h-full">
    <div id="testimonial-placeholder" class="p-4 text-gray-600 text-center">
        Pilih pekerja untuk melihat testimoni
    </div>
</div>

<script>
    function fetchWorkerTestimonials(workerId) {
        const testimonialContainer = document.getElementById('testimonial-container');

        testimonialContainer.innerHTML = `
            <div class="p-4 text-gray-600 text-center">
                Memuat testimoni...
            </div>
        `;

        fetch(`/biru/api/get_testimoni/${workerId}/`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Gagal memuat testimoni');
                }
                return response.json();
            })
            .then(data => {
                testimonialContainer.innerHTML = '';

                if (data.testimonials && data.testimonials.length > 0) {
                    data.testimonials.forEach(testi => {
                        const testiElement = document.createElement('div');
                        testiElement.classList.add(
                            'p-4', 
                            'text-gray-800', 
                            'border-b', 
                            'border-gray-200'
                        );
                        const starRating = '★'.repeat(testi.rating) + '☆'.repeat(5 - testi.rating);
                        
                        testiElement.innerHTML = `
                            <div class="flex items-center justify-between mb-2">
                                <div class="text-yellow-500">
                                    ${starRating}
                                </div>
                                <span class="text-sm text-gray-500">${testi.date}</span>
                            </div>
                            <p class="mb-2 font-medium">Oleh: ${testi.author}</p>
                            <p>${testi.comment}</p>
                        `;
                        
                        testimonialContainer.appendChild(testiElement);
                    });
                } else {
                    testimonialContainer.innerHTML = `
                        <div class="p-4 text-gray-600 text-center">
                            Belum ada testimoni untuk pekerja ini.
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                testimonialContainer.innerHTML = `
                    <div class="p-4 text-red-600 text-center">
                        Gagal memuat testimoni. Silakan coba lagi.
                    </div>
                `;
            });
    }

    document.addEventListener('DOMContentLoaded', () => {
        const workerBoxes = document.querySelectorAll('.worker-box');
        
        workerBoxes.forEach(box => {
            box.addEventListener('click', () => {
                const workerId = box.getAttribute('data-worker-id');
                if (workerId) {
                    fetchWorkerTestimonials(workerId);
                }
            });
        });
    });
</script>